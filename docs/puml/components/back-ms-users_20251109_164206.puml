@startuml back-ms-users Hexagonal Architecture
!theme plain
title Back Ms Users - Hexagonal Architecture

left to right direction

' === EXTERNAL ACTORS ===
rectangle "External Actors" {
  [Web Client] as WebClient
  [Mobile App] as MobileApp
  [API Consumer] as APIConsumer
  [Database] as Database
}

' === Back Ms Users SERVICE ===
package "back-ms-users" as ServiceMS {
  package "Infrastructure Layer" as ServiceInfra {
    package "Input Adapters" as ServiceInputAdapters {
      [LocationController] as LocationController
      [UserController] as UserController
    }
    
    package "Output Adapters" as ServiceOutputAdapters {
      [CityRepositoryAdapter] as CityRepositoryAdapter
      [RegionRepositoryAdapter] as RegionRepositoryAdapter
      [CountryRepositoryAdapter] as CountryRepositoryAdapter
      [NeighborhoodRepositoryAdapter] as NeighborhoodRepositoryAdapter
      [UserRepositoryAdapter] as UserRepositoryAdapter
      [LocationRepositoryAdapter] as LocationRepositoryAdapter
    }
    
    package "Persistence" as ServicePersistence {
      [JpaRegionRepository] as JpaRegionRepository
      [JpaNeighborhoodRepository] as JpaNeighborhoodRepository
      [JpaUserRepository] as JpaUserRepository
      [JpaCityRepository] as JpaCityRepository
      [JpaCountryRepository] as JpaCountryRepository
      [JpaLocationRepository] as JpaLocationRepository
      
      [NeighborhoodDbo] as NeighborhoodDbo
      [LocationDbo] as LocationDbo
      [RegionDbo] as RegionDbo
      [CityDbo] as CityDbo
      [UserDbo] as UserDbo
      [CountryDbo] as CountryDbo
    }
    
    package "Configuration" as ServiceConfig {
      [ApplicationConfiguration] as ApplicationConfiguration
      [OpenApiConfiguration] as OpenApiConfiguration
      [SecurityConfiguration] as SecurityConfiguration
    }
    
    package "Exceptions" as ServiceExceptions {
      [ConflictException] as ConflictException
      [InternalServerErrorException] as InternalServerErrorException
      [GlobalExceptionHandler] as GlobalExceptionHandler
      [NotFoundException] as NotFoundException
    }
  }
  
  package "Application Layer" as ServiceApplication {
    package "Services" as ServiceServices {
      [UserService] as UserService
      [LocationService] as LocationService
    }
    
    package "Mappers" as ServiceMappers {
      [RegionMapper] as RegionMapper
      [CityMapper] as CityMapper
      [CountryMapper] as CountryMapper
      [UserMapper] as UserMapper
      [LocationMapper] as LocationMapper
      [NeighborhoodMapper] as NeighborhoodMapper
    }
    
    package "DTOs" as ServiceDTOs {
      [City DTOs] as CityDTOsGroup
      [Location DTOs] as LocationDTOsGroup
      [CountryInfo DTOs] as CountryInfoDTOsGroup
      [NeighborhoodInfo DTOs] as NeighborhoodInfoDTOsGroup
      [CitiesByRegion DTOs] as CitiesByRegionDTOsGroup
      [Neighborhood DTOs] as NeighborhoodDTOsGroup
      [Countrie DTOs] as CountrieDTOsGroup
      [Country DTOs] as CountryDTOsGroup
      [CityInfo DTOs] as CityInfoDTOsGroup
      [Region DTOs] as RegionDTOsGroup
      [NeighborhoodsByCity DTOs] as NeighborhoodsByCityDTOsGroup
      [RegionInfo DTOs] as RegionInfoDTOsGroup
      [RegionsByCountry DTOs] as RegionsByCountryDTOsGroup
      [User DTOs] as UserDTOsGroup
    }
    
  }
  
  package "Domain Layer" as ServiceDomain {
    package "Domain Models" as ServiceDomainModels {
      [Neighborhood] as NeighborhoodModel
      [Country] as CountryModel
      [Region] as RegionModel
      [User] as UserModel
      [EntityStatus] as EntityStatusModel
      [City] as CityModel
      [Location] as LocationModel
    }
    
    package "Input Ports" as ServiceInputPorts {
      [UserUseCase] as UserUseCase
      [LocationUseCase] as LocationUseCase
    }
    
    package "Output Ports" as ServiceOutputPorts {
      [CountryRepositoryPort] as CountryRepositoryPort
      [UserRepositoryPort] as UserRepositoryPort
      [NeighborhoodRepositoryPort] as NeighborhoodRepositoryPort
      [CityRepositoryPort] as CityRepositoryPort
      [RegionRepositoryPort] as RegionRepositoryPort
      [LocationRepositoryPort] as LocationRepositoryPort
    }
  }
}

' === EXTERNAL CONNECTIONS ===
WebClient --> ServiceInputAdapters : HTTP/REST
MobileApp --> ServiceInputAdapters : HTTP/REST
APIConsumer --> ServiceInputAdapters : HTTP/REST

' === PACKAGE CONNECTIONS ===

ServiceInputAdapters --> ServiceInputPorts : "delegates to use cases"


ServiceServices ..|> ServiceInputPorts : "implements use cases"


ServiceServices --> ServiceOutputPorts : "uses repository ports"


ServiceOutputAdapters ..|> ServiceOutputPorts : "implements ports"


ServiceOutputAdapters --> ServicePersistence : "uses JPA repositories"


ServiceServices --> ServiceMappers : "uses mappers"


ServiceOutputAdapters --> ServiceMappers : "uses mappers"


ServiceServices --> ServiceDTOs : "uses DTOs"


ServiceConfig --> ServiceInputAdapters : "configures & handles exceptions"


ServiceConfig --> ServiceExceptions : "handles custom exceptions"

ServiceDomainModels --> EntityStatusModel : "uses status"

' === INTERNAL PERSISTENCE CONNECTIONS ===
JpaRegionRepository --> RegionDbo : "manages"
JpaNeighborhoodRepository --> NeighborhoodDbo : "manages"
JpaUserRepository --> UserDbo : "manages"
JpaCityRepository --> CityDbo : "manages"
JpaCountryRepository --> CountryDbo : "manages"
JpaLocationRepository --> LocationDbo : "manages"

' === DATABASE CONNECTION ===
ServicePersistence --> Database : "persists data"

note right of ServiceMS
  <b>Back Ms Users Service Architecture</b>
  • <b>7 Domain Entities</b>: Neighborhood, Country, Region, User, EntityStatus, City, Location, 
  • <b>2 Use Cases</b>: UserUseCase, LocationUseCase, 
  • <b>6 Repository Ports</b>: One per entity
  • <b>2 Services</b>: UserService, LocationService, 
  • <b>6 Mappers</b>: MapStruct transformations
  • <b>4 Custom Exceptions</b>: ConflictException, InternalServerErrorException, GlobalExceptionHandler, NotFoundException, 
  • <b>Complete CRUD</b>: All entities support full operations
  • <b>Logging</b>: LoggingUtils used across all layers
end note

note bottom
  <b>Hexagonal Architecture Principles</b>
  • <b>Dependency Rule</b>: All dependencies point inward toward domain
  • <b>Ports & Adapters</b>: External communication via interfaces
  • <b>Domain Isolation</b>: Pure business logic without framework dependencies
  • <b>Testability</b>: Each layer independently testable
end note

@enduml