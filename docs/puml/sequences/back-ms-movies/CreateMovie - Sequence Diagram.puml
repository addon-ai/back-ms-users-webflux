@startuml Create Movie
!theme plain
title Create Movie - Hexagonal Architecture Flow

actor Client
participant "MovieController\n(Input Adapter)" as Controller
participant "MovieUseCase\n(Domain Port)" as UseCase
participant "MovieService\n(Application Service)" as Service
participant "MovieMapper\n(Application Layer)" as Mapper
participant "MovieRepositoryPort\n(Domain Port)" as RepoPort
participant "MovieRepositoryAdapter\n(Output Adapter)" as RepoAdapter
participant "JpaMovieRepository\n(Infrastructure)" as JpaRepo
database "Database" as DB

Client -> Controller: POST /movies
activate Controller

Controller -> UseCase: create(CreateMovieRequestContent)
activate UseCase
note right: UseCase is implemented by MovieService

UseCase -> Mapper: fromCreateRequest(CreateMovieRequestContent)
activate Mapper
Mapper --> UseCase: Movie (domain object)
deactivate Mapper

UseCase -> RepoPort: save(Movie)
activate RepoPort
RepoPort -> RepoAdapter: save(Movie)
activate RepoAdapter

RepoAdapter -> Mapper: toDbo(Movie)
activate Mapper
Mapper --> RepoAdapter: MovieDbo
deactivate Mapper

RepoAdapter -> JpaRepo: save(MovieDbo)
activate JpaRepo
JpaRepo -> DB: INSERT INTO movies
DB --> JpaRepo: MovieDbo
JpaRepo --> RepoAdapter: MovieDbo
deactivate JpaRepo

RepoAdapter -> Mapper: toDomain(MovieDbo)
activate Mapper
Mapper --> RepoAdapter: Movie
deactivate Mapper

RepoAdapter --> RepoPort: Movie
deactivate RepoAdapter
RepoPort --> UseCase: Movie
deactivate RepoPort

UseCase -> Mapper: toCreateResponse(Movie)
activate Mapper
Mapper --> UseCase: CreateMovieResponseContent
deactivate Mapper

UseCase --> Controller: CreateMovieResponseContent
deactivate UseCase

Controller --> Client: HTTP 201
deactivate Controller

@enduml