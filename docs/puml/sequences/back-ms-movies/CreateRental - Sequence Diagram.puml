@startuml Create Rental
!theme plain
title Create Rental - Hexagonal Architecture Flow

actor Client
participant "RentalController\n(Input Adapter)" as Controller
participant "RentalUseCase\n(Domain Port)" as UseCase
participant "RentalService\n(Application Service)" as Service
participant "RentalMapper\n(Application Layer)" as Mapper
participant "RentalRepositoryPort\n(Domain Port)" as RepoPort
participant "RentalRepositoryAdapter\n(Output Adapter)" as RepoAdapter
participant "JpaRentalRepository\n(Infrastructure)" as JpaRepo
database "Database" as DB

Client -> Controller: POST /rentals
activate Controller

Controller -> UseCase: create(CreateRentalRequestContent)
activate UseCase
note right: UseCase is implemented by RentalService

UseCase -> Mapper: fromCreateRequest(CreateRentalRequestContent)
activate Mapper
Mapper --> UseCase: Rental (domain object)
deactivate Mapper

UseCase -> RepoPort: save(Rental)
activate RepoPort
RepoPort -> RepoAdapter: save(Rental)
activate RepoAdapter

RepoAdapter -> Mapper: toDbo(Rental)
activate Mapper
Mapper --> RepoAdapter: RentalDbo
deactivate Mapper

RepoAdapter -> JpaRepo: save(RentalDbo)
activate JpaRepo
JpaRepo -> DB: INSERT INTO rentals
DB --> JpaRepo: RentalDbo
JpaRepo --> RepoAdapter: RentalDbo
deactivate JpaRepo

RepoAdapter -> Mapper: toDomain(RentalDbo)
activate Mapper
Mapper --> RepoAdapter: Rental
deactivate Mapper

RepoAdapter --> RepoPort: Rental
deactivate RepoAdapter
RepoPort --> UseCase: Rental
deactivate RepoPort

UseCase -> Mapper: toCreateResponse(Rental)
activate Mapper
Mapper --> UseCase: CreateRentalResponseContent
deactivate Mapper

UseCase --> Controller: CreateRentalResponseContent
deactivate UseCase

Controller --> Client: HTTP 201
deactivate Controller

@enduml