@startuml Create User
!theme plain
title Create User - Hexagonal Architecture Flow

actor Client
participant "UserController\n(Input Adapter)" as Controller
participant "UserUseCase\n(Domain Port)" as UseCase
participant "UserService\n(Application Service)" as Service
participant "UserMapper\n(Application Layer)" as Mapper
participant "UserRepositoryPort\n(Domain Port)" as RepoPort
participant "UserRepositoryAdapter\n(Output Adapter)" as RepoAdapter
participant "JpaUserRepository\n(Infrastructure)" as JpaRepo
database "Database" as DB

Client -> Controller: POST /users
activate Controller

Controller -> UseCase: create(CreateUserRequestContent)
activate UseCase
note right: UseCase is implemented by UserService

UseCase -> Mapper: fromCreateRequest(CreateUserRequestContent)
activate Mapper
Mapper --> UseCase: User (domain object)
deactivate Mapper

UseCase -> RepoPort: save(User)
activate RepoPort
RepoPort -> RepoAdapter: save(User)
activate RepoAdapter

RepoAdapter -> Mapper: toDbo(User)
activate Mapper
Mapper --> RepoAdapter: UserDbo
deactivate Mapper

RepoAdapter -> JpaRepo: save(UserDbo)
activate JpaRepo
JpaRepo -> DB: INSERT INTO users
DB --> JpaRepo: UserDbo
JpaRepo --> RepoAdapter: UserDbo
deactivate JpaRepo

RepoAdapter -> Mapper: toDomain(UserDbo)
activate Mapper
Mapper --> RepoAdapter: User
deactivate Mapper

RepoAdapter --> RepoPort: User
deactivate RepoAdapter
RepoPort --> UseCase: User
deactivate RepoPort

UseCase -> Mapper: toCreateResponse(User)
activate Mapper
Mapper --> UseCase: CreateUserResponseContent
deactivate Mapper

UseCase --> Controller: CreateUserResponseContent
deactivate UseCase

Controller --> Client: HTTP 201
deactivate Controller

@enduml