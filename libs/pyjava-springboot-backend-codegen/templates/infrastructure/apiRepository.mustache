{{#isJpaRepository}}
package {{packageName}};

import {{infra_entity}}.{{entityName}}Dbo;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;
import java.util.List;
import java.util.Optional;
import java.util.UUID;

/**
 * Spring Data JPA Repository for {{entityName}} entities.
 * <p>
 * This interface extends JpaRepository to provide standard CRUD operations
 * and includes custom query methods for specific business requirements.
 * It operates on {{entityName}}Dbo entities for database persistence.
 * </p>
 * 
 * @author {{author}}
 * @version {{version}}
 */
@Repository
public interface {{classname}} extends JpaRepository<{{entityName}}Dbo, UUID> {
    
    /**
     * Find entities with pagination and search functionality.
     */
    @Query("SELECT e FROM {{entityName}}Dbo e WHERE " +
           "(:search IS NULL OR :search = '' OR " +
           "LOWER(e.username) LIKE LOWER(CONCAT('%', :search, '%')) OR " +
           "LOWER(e.email) LIKE LOWER(CONCAT('%', :search, '%')) OR " +
           "LOWER(e.firstName) LIKE LOWER(CONCAT('%', :search, '%')) OR " +
           "LOWER(e.lastName) LIKE LOWER(CONCAT('%', :search, '%'))) " +
           "ORDER BY e.createdAt DESC")
    Page<{{entityName}}Dbo> findBySearchTerm(@Param("search") String search, Pageable pageable);
    
    /**
     * Count entities matching search term.
     */
    @Query("SELECT COUNT(e) FROM {{entityName}}Dbo e WHERE " +
           "(:search IS NULL OR :search = '' OR " +
           "LOWER(e.username) LIKE LOWER(CONCAT('%', :search, '%')) OR " +
           "LOWER(e.email) LIKE LOWER(CONCAT('%', :search, '%')) OR " +
           "LOWER(e.firstName) LIKE LOWER(CONCAT('%', :search, '%')) OR " +
           "LOWER(e.lastName) LIKE LOWER(CONCAT('%', :search, '%')))")
    Long countBySearchTerm(@Param("search") String search);
    
    /**
     * Find all entities with pagination.
     */
    @Query("SELECT e FROM {{entityName}}Dbo e ORDER BY e.createdAt DESC")
    Page<{{entityName}}Dbo> findAllPaged(Pageable pageable);
}
{{/isJpaRepository}}

{{#isAdapter}}
package {{packageName}};

import {{domain_ports_output}}.{{portName}};
import {{domain_model}}.{{entityName}};
import {{infra_entity}}.{{entityName}}Dbo;
import {{infra_repository}}.{{jpaRepositoryName}};
import {{application_mapper}}.{{entityName}}Mapper;
import {{infra_config_exceptions}}.InternalServerErrorException;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.stereotype.Component;
import java.util.List;
import java.util.Optional;
import java.util.UUID;

/**
 * Repository adapter implementing the {{entityName}} domain port.
 * <p>
 * This adapter serves as the output adapter in Clean Architecture,
 * implementing the domain repository interface and delegating to
 * Spring Data JPA repository. It handles the conversion between
 * domain objects and database entities using MapStruct.
 * </p>
 * 
 * @author {{author}}
 * @version {{version}}
 */
@Slf4j
@Component
@RequiredArgsConstructor
public class {{classname}} implements {{portName}} {

    private final {{jpaRepositoryName}} jpaRepository;
    private final {{entityName}}Mapper mapper;

    @Override
    public {{entityName}} save({{entityName}} {{entityVarName}}) {
        log.debug("Saving {{entityName}}: {}", {{entityVarName}});
        try {
            {{entityName}}Dbo dbo = mapper.toDbo({{entityVarName}});
            {{entityName}}Dbo savedDbo = jpaRepository.save(dbo);
            return mapper.toDomain(savedDbo);
        } catch (org.springframework.dao.DuplicateKeyException | org.springframework.dao.DataIntegrityViolationException e) {
            log.error("Database constraint violation while saving {{entityName}}: {}", e.getMessage(), e);
            throw e; // Propagate business exceptions to service layer
        } catch (Exception e) {
            log.error("Database error while saving {{entityName}}: {}", e.getMessage(), e);
            throw new InternalServerErrorException("Failed to save {{entityName}}", e);
        }
    }

    @Override
    public Optional<{{entityName}}> findById(String id) {
        log.debug("Finding {{entityName}} by id: {}", id);
        try {
            return jpaRepository.findById(UUID.fromString(id))
                    .map(mapper::toDomain);
        } catch (Exception e) {
            log.error("Database error while finding {{entityName}} by id {}: {}", id, e.getMessage(), e);
            throw new InternalServerErrorException("Failed to find {{entityName}} by id", e);
        }
    }

    @Override
    public List<{{entityName}}> findAll() {
        log.debug("Finding all {{entityNamePlural}}");
        try {
            return mapper.toDomainList(jpaRepository.findAll());
        } catch (Exception e) {
            log.error("Database error while finding all {{entityNamePlural}}: {}", e.getMessage(), e);
            throw new InternalServerErrorException("Failed to find all {{entityNamePlural}}", e);
        }
    }

    @Override
    public void deleteById(String id) {
        log.debug("Deleting {{entityName}} by id: {}", id);
        try {
            jpaRepository.deleteById(UUID.fromString(id));
        } catch (Exception e) {
            log.error("Database error while deleting {{entityName}} by id {}: {}", id, e.getMessage(), e);
            throw new InternalServerErrorException("Failed to delete {{entityName}} by id", e);
        }
    }

    @Override
    public boolean existsById(String id) {
        log.debug("Checking if {{entityName}} exists by id: {}", id);
        try {
            return jpaRepository.existsById(UUID.fromString(id));
        } catch (Exception e) {
            log.error("Database error while checking if {{entityName}} exists by id {}: {}", id, e.getMessage(), e);
            throw new InternalServerErrorException("Failed to check if {{entityName}} exists by id", e);
        }
    }

    @Override
    public List<{{entityName}}> findBySearchTerm(String search, Integer page, Integer size) {
        log.debug("Searching {{entityNamePlural}} with term: {}, page: {}, size: {}", search, page, size);
        try {
            org.springframework.data.domain.Pageable pageable = org.springframework.data.domain.PageRequest.of(
                page != null && page > 0 ? page - 1 : 0, 
                size != null && size > 0 ? size : 20
            );
            
            return jpaRepository.findBySearchTerm(search != null ? search : "", pageable)
                    .map(mapper::toDomain)
                    .getContent();
        } catch (org.springframework.dao.DuplicateKeyException | org.springframework.dao.DataIntegrityViolationException e) {
            log.error("Database constraint violation while searching {{entityNamePlural}}: {}", e.getMessage(), e);
            throw e;
        } catch (Exception e) {
            log.error("Database error while searching {{entityNamePlural}}: {}", e.getMessage(), e);
            throw new InternalServerErrorException("Failed to search {{entityNamePlural}}", e);
        }
    }
    
    // Additional business methods with pagination
    public Page<{{entityName}}> findBySearchTermPaged(String search, org.springframework.data.domain.Pageable pageable) {
        log.debug("Searching {{entityNamePlural}} with term: {} and pagination: {}", search, pageable);
        return jpaRepository.findBySearchTerm(search, pageable)
                .map(mapper::toDomain);
    }
    
    @Override
    public List<{{entityName}}> findAllPaged(Integer page, Integer size) {
        log.debug("Finding all {{entityNamePlural}} with pagination: page={}, size={}", page, size);
        try {
            org.springframework.data.domain.Pageable pageable = org.springframework.data.domain.PageRequest.of(
                page != null && page > 0 ? page - 1 : 0, 
                size != null && size > 0 ? size : 20
            );
            
            return jpaRepository.findAllPaged(pageable)
                    .map(mapper::toDomain)
                    .getContent();
        } catch (Exception e) {
            log.error("Database error while finding all {{entityNamePlural}}: {}", e.getMessage(), e);
            throw new InternalServerErrorException("Failed to find all {{entityNamePlural}}", e);
        }
    }
    
    public Page<{{entityName}}> findAllPagedInternal(org.springframework.data.domain.Pageable pageable) {
        log.debug("Finding all {{entityNamePlural}} with pagination: {}", pageable);
        return jpaRepository.findAllPaged(pageable)
                .map(mapper::toDomain);
    }
{{#hasComplexMethods}}
    
{{#repositoryMethods}}
    @Override
    public List<{{entityName}}> {{methodName}}({{parameters}}) {
        log.debug("Executing {{methodName}} with parameters: {}", {{parameterName}});
        try {
            // TODO: Implement custom query for {{methodName}}
            return mapper.toDomainList(jpaRepository.findAll());
        } catch (Exception e) {
            log.error("Database error in {{methodName}}: {}", e.getMessage(), e);
            throw new InternalServerErrorException("Failed to execute {{methodName}}", e);
        }
    }
    
{{/repositoryMethods}}
{{/hasComplexMethods}}
}
{{/isAdapter}}