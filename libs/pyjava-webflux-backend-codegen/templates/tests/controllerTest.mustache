package {{packageName}};

import {{basePackage}}.domain.ports.input.{{entityName}}UseCase;
{{#dtoImports}}
import {{.}};
{{/dtoImports}}
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.junit.jupiter.MockitoExtension;
import reactor.core.publisher.Mono;

import java.time.Duration;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyString;
import static org.mockito.Mockito.when;

/**
 * Unit tests for {{classname}}.
 * 
 * @author {{author}}
 * @version {{version}}
 */
@ExtendWith(MockitoExtension.class)
class {{classname}}Test {

    @Mock
    private {{entityName}}UseCase {{entityVarName}}UseCase;

    @InjectMocks
    private {{classname}} {{entityVarName}}Controller;

{{#hasCreate}}
    @Test
    void create{{entityName}}_ShouldReturnCreated_WhenValidRequest() {
        // Given
        Create{{entityName}}RequestContent request = Create{{entityName}}RequestContent.builder()
{{#createProperties}}
{{#required}}
{{#isString}}
            .{{name}}("test-{{name}}")
{{/isString}}
{{#isEmail}}
            .{{name}}("test@example.com")
{{/isEmail}}
{{#isBoolean}}
            .{{name}}(true)
{{/isBoolean}}
{{#isInteger}}
            .{{name}}(1)
{{/isInteger}}
{{/required}}
{{/createProperties}}
            .build();
        Create{{entityName}}ResponseContent response = Create{{entityName}}ResponseContent.builder()
            .build();
        
        when({{entityVarName}}UseCase.create(any(Create{{entityName}}RequestContent.class)))
            .thenReturn(Mono.just(response));

        // When
        Create{{entityName}}ResponseContent result = {{entityVarName}}Controller.create{{entityName}}(request, "test-request-id", null, null)
            .block(Duration.ofSeconds(5));

        // Then
        assertEquals(response, result);
    }
{{/hasCreate}}

{{#hasGet}}
    @Test
    void get{{entityName}}_ShouldReturnOk_WhenEntityExists() {
        // Given
        String {{entityVarName}}Id = "test-id";
        Get{{entityName}}ResponseContent response = Get{{entityName}}ResponseContent.builder()
            .build();
        
        when({{entityVarName}}UseCase.get(anyString()))
            .thenReturn(Mono.just(response));

        // When
        Get{{entityName}}ResponseContent result = {{entityVarName}}Controller.get{{entityName}}({{entityVarName}}Id, "test-request-id", null, null)
            .block(Duration.ofSeconds(5));

        // Then
        assertEquals(response, result);
    }
{{/hasGet}}

{{#hasUpdate}}
    @Test
    void update{{entityName}}_ShouldReturnOk_WhenValidRequest() {
        // Given
        String {{entityVarName}}Id = "test-id";
        Update{{entityName}}RequestContent request = Update{{entityName}}RequestContent.builder()
{{#updateProperties}}
{{#isString}}
            .{{name}}("updated-{{name}}")
{{/isString}}
{{#isEmail}}
            .{{name}}("updated@example.com")
{{/isEmail}}
{{#isBoolean}}
            .{{name}}(false)
{{/isBoolean}}
{{#isInteger}}
            .{{name}}(2)
{{/isInteger}}
{{/updateProperties}}
            .build();
        Update{{entityName}}ResponseContent response = Update{{entityName}}ResponseContent.builder()
            .build();
        
        when({{entityVarName}}UseCase.update(anyString(), any(Update{{entityName}}RequestContent.class)))
            .thenReturn(Mono.just(response));

        // When
        Update{{entityName}}ResponseContent result = {{entityVarName}}Controller.update{{entityName}}({{entityVarName}}Id, request, "test-request-id", null, null)
            .block(Duration.ofSeconds(5));

        // Then
        assertEquals(response, result);
    }
{{/hasUpdate}}

{{#hasDelete}}
    @Test
    void delete{{entityName}}_ShouldReturnOk_WhenEntityExists() {
        // Given
        String {{entityVarName}}Id = "test-id";
        Delete{{entityName}}ResponseContent response = Delete{{entityName}}ResponseContent.builder()
            .deleted(true)
            .message("{{entityName}} deleted successfully")
            .build();
        
        when({{entityVarName}}UseCase.delete(anyString()))
            .thenReturn(Mono.just(response));

        // When
        Delete{{entityName}}ResponseContent result = {{entityVarName}}Controller.delete{{entityName}}({{entityVarName}}Id, "test-request-id", null, null)
            .block(Duration.ofSeconds(5));

        // Then
        assertEquals(response, result);
    }
{{/hasDelete}}

{{#hasList}}
    @Test
    void list{{entityName}}s_ShouldReturnOk() {
        // Given
        List{{entityName}}sResponseContent response = List{{entityName}}sResponseContent.builder()
            .build();
        
        when({{entityVarName}}UseCase.list(any(), any(), any(), any(), any(), any()))
            .thenReturn(Mono.just(response));

        // When
        List{{entityName}}sResponseContent result = {{entityVarName}}Controller.list{{entityName}}s(1, 20, null, null, null, null, "test-request-id", null, null)
            .block(Duration.ofSeconds(5));

        // Then
        assertEquals(response, result);
    }
{{/hasList}}

{{#complexOperations}}
    @Test
    void {{methodName}}_ShouldReturnOk() {
        // Given
        {{responseType}} response = {{responseType}}.builder()
            .build();
        
        when({{entityVarName}}UseCase.{{methodName}}({{#pathVariables}}anyString(){{#hasMore}}, {{/hasMore}}{{/pathVariables}}))
            .thenReturn(Mono.just(response));

        // When
        {{responseType}} result = {{entityVarName}}Controller.{{methodName}}({{#pathVariables}}"test-{{name}}"{{#hasMore}}, {{/hasMore}}{{/pathVariables}}{{#pathVariables}}, {{/pathVariables}}"test-request-id", null, null)
            .block(Duration.ofSeconds(5));

        // Then
        assertEquals(response, result);
    }

{{/complexOperations}}
}