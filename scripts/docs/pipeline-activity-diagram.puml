@startuml Pipeline Activity Diagram
!theme plain
skinparam activity {
    BackgroundColor #E1F5FE
    BorderColor #0277BD
    FontColor #01579B
}
skinparam activityDiamond {
    BackgroundColor #FFF3E0
    BorderColor #F57C00
}

title Code Generation Pipeline Activity Diagram

start

:ğŸš€ Initialize Pipeline;
note right
  - Get script directory
  - Set project root
  - Define config paths
end note

:ğŸ“‹ Load Project Configuration;
note right
  Read params.json array
  Extract first project name
end note

:ğŸŒ¿ Create Pipeline Branch;
note right
  Execute libs/utils/branch_manager.py
  Create timestamped feature branch
end note

:ğŸ” Check Python 3 Availability;

if (Python 3 available?) then (no)
  :âŒ Exit with error;
  stop
else (yes)
  :âœ… Python 3 confirmed;
endif

:ğŸ“¦ Check Dependencies;
note right
  - pystache
  - requests
end note

if (Dependencies missing?) then (yes)
  :ğŸ“¥ Install missing dependencies;
else (no)
  :âœ… Dependencies satisfied;
endif

:ğŸ” Check Existing Projects;

if (GitHub token set AND projects exist?) then (yes)
  :ğŸ”’ Backup Git history;
  note right
    Execute py-github-integration.py
    with --backup-only flag
  end note
else (no)
  :ğŸ—‘ï¸ Clean existing projects;
  note right
    Remove projects/ directory
  end note
endif

:ğŸ—ï¸ Generate Java Backend Projects;
note right
  Execute libs/utils/process_projects.py
  - SpringBoot or WebFlux
  - Hexagonal architecture
  - Based on project type in config
end note

:ğŸ“‹ Generate JSON Schemas;
note right
  Execute jsonschema-generator.py
  From OpenAPI specifications
end note

:ğŸ² Generate Fake Data;
note right
  Execute fake-data-generator.py
  For unit testing
end note

:ğŸ“š Generate OpenAPI Documentation;
note right
  Execute pyopenapi-docs-generator.py
  PlantUML, Markdown, TXT formats
end note

:ğŸ—ï¸ Generate Architectural Diagrams;
note right
  Execute pyarchitect-docs-generator.py
  - Component diagrams
  - Sequence diagrams
end note

:ğŸ—„ï¸ Generate SQL DDL Scripts;
note right
  Execute pygenerate-sql-from-openapi.py
  From OpenAPI specifications
end note

:ğŸ“‹ Copy Flyway Migration Scripts;
note right
  Execute libs/utils/flyway_migration_copier.py
  - Read flywayScripts from params.json
  - Copy from sql/{sgbd}/ to projects
  - Merge into V1__initial_schema.sql
  - Place in main/test migration dirs
end note

:ğŸ” Check GitHub Integration;

if (GitHub enabled in config?) then (yes)
  if (GitHub token set?) then (yes)
    :ğŸ™ Synchronize with GitHub;
    note right
      Execute py-github-integration.py
      - Create/update repositories
      - Push generated code
    end note
    
    :ğŸ”’ Apply Branch Protection;
    note right
      Execute apply_branch_protection.py
      Protect main branches
    end note
  else (no)
    :âš ï¸ Skip GitHub sync;
    note right
      GITHUB_TOKEN not set
    end note
  endif
else (no)
  :âš ï¸ GitHub integration disabled;
endif

:ğŸ’¾ Commit Pipeline Changes;
note right
  Execute libs/utils/branch_manager.py --commit
  Commit all generated files
end note

:ğŸ‰ Pipeline Complete;
note right
  Generated outputs:
  - Java projects
  - JSON schemas
  - Documentation
  - SQL scripts
  - GitHub repositories
end note

stop

@enduml
